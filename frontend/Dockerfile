# ğŸ“ Frontend Dockerfile (Finalized)

# ===== Stage 1: Build =====
FROM node:20-alpine AS builder

# ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
WORKDIR /app

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package*.json ./
RUN npm ci

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ”ãƒ¼ã¨ãƒ“ãƒ«ãƒ‰
COPY . .
RUN npm run build

# ===== Stage 2: Production (nginx) =====
FROM nginx:alpine AS production

# ãƒ“ãƒ«ãƒ‰çµæœã‚’ nginx é…ç½®å…ˆã«ã‚³ãƒ”ãƒ¼
COPY --from=builder /app/dist /usr/share/nginx/html

# nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
COPY nginx.conf /etc/nginx/nginx.conf

# ãƒãƒ¼ãƒˆé–‹æ”¾
EXPOSE 80

# Healthcheck è¨­å®š
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:80/ || exit 1

# nginx èµ·å‹•
CMD ["nginx", "-g", "daemon off;"]
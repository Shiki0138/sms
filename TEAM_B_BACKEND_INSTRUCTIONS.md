# ğŸ› ï¸ ãƒãƒ¼ãƒ B - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºæŒ‡ç¤ºæ›¸ (æ­£å¼ãƒªãƒªãƒ¼ã‚¹æº–å‚™ç‰ˆ)

## ğŸ“‹ ãƒŸãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦
ç¾å®¹å®¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰éƒ¨é–€ã¨ã—ã¦ã€3ã¤ã®æ–™é‡‘ãƒ—ãƒ©ãƒ³å®Ÿè£…ãƒ»æ±ºæ¸ˆæ©Ÿèƒ½ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚’æ‹…å½“ã—ã€å•†ç”¨ãƒªãƒªãƒ¼ã‚¹æº–å‚™ã‚’å®Œäº†ã•ã›ã‚‹

## ğŸ¯ ãƒãƒ¼ãƒ Bæ¦‚è¦
- **ãƒãƒ¼ãƒ å**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºãƒãƒ¼ãƒ 
- **ä¸»æ‹…å½“é ˜åŸŸ**: Node.js + Express APIå®Ÿè£…ãƒ»æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
- **å°‚é–€æŠ€è¡“**: Node.js, TypeScript, Express, Prisma, PostgreSQL, Redis
- **æœ€çµ‚ç›®æ¨™**: ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§å®‰å…¨ãªå•†ç”¨ã‚°ãƒ¬ãƒ¼ãƒ‰ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 

---

## ğŸ¯ ãƒãƒ¼ãƒ Bã®å®Ÿè£…å¯¾è±¡

### âš¡ **æœ€å„ªå…ˆå®Ÿè£…ï¼ˆPhase 1ï¼‰**

#### 1. ğŸš€ API ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
```typescript
// å®Ÿè£…å¯¾è±¡: src/middleware/performance.ts æ‹¡å¼µ
ã€æœ€é©åŒ–é …ç›®ã€‘
âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›£è¦–ãƒ»ãƒ­ã‚°å‡ºåŠ›
âœ… ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªæ¤œå‡ºãƒ»è‡ªå‹•ã‚¢ãƒ©ãƒ¼ãƒˆ  
âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–ãƒ»ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æœ€é©åŒ–
âœ… ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«æœ€é©åŒ–
âœ… Redis ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥å¼·åŒ–

ã€ç›®æ¨™å€¤ã€‘
- APIå¿œç­”æ™‚é–“: 95%ãŒ100msä»¥å†…
- åŒæ™‚æ¥ç¶š: 500+ ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 512MBä»¥ä¸‹ç¶­æŒ
```

#### 2. ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–ãƒ»ã‚¯ã‚¨ãƒªãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
```sql
-- å®Ÿè£…å¯¾è±¡: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ãƒ»ã‚¯ã‚¨ãƒªæ”¹å–„
ã€æœ€é©åŒ–å¯¾è±¡ã€‘
âœ… é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¯ã‚¨ãƒªã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
âœ… JOINå‡¦ç†ã®æœ€é©åŒ–
âœ… Prisma ã‚¯ã‚¨ãƒªã® N+1 å•é¡Œè§£æ±º
âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®šæœ€é©åŒ–
âœ… å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½

ã€å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
- prisma/schema.prisma - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©
- src/services/* - ã‚¯ã‚¨ãƒªæœ€é©åŒ–  
- src/database.ts - æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š
```

#### 3. ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ãƒ»ç›£æŸ»æ©Ÿèƒ½
```typescript
// å®Ÿè£…å¯¾è±¡: src/middleware/security.ts + src/services/securityService.ts
ã€å¼·åŒ–é …ç›®ã€‘
âœ… API ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¼·åŒ–ï¼ˆIPãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ï¼‰
âœ… ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥ãƒ»è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
âœ… API ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è©³ç´°åŒ–
âœ… OWASP Top10 å¯¾ç­–å¼·åŒ–

ã€æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‘
- GET /api/v1/security/events - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
- POST /api/v1/security/block-ip - IPæ‰‹å‹•ãƒ–ãƒ­ãƒƒã‚¯
- GET /api/v1/security/audit-log - ç›£æŸ»ãƒ­ã‚°å–å¾—
```

### ğŸ”¥ **Phase 2å®Ÿè£…å¯¾è±¡**

#### 4. ğŸ“Š é«˜åº¦ãªåˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½å¼·åŒ–
```typescript
// å®Ÿè£…å¯¾è±¡: src/controllers/analyticsController.ts å¤§å¹…æ‹¡å¼µ
ã€æ–°æ©Ÿèƒ½ã€‘
âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å£²ä¸Šåˆ†æï¼ˆæ™‚é–“ãƒ»æ—¥ãƒ»é€±ãƒ»æœˆãƒ»å¹´ï¼‰
âœ… é¡§å®¢è¡Œå‹•åˆ†æï¼ˆæ¥åº—ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»è³¼è²·å‚¾å‘ï¼‰
âœ… ã‚¹ã‚¿ãƒƒãƒ•ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
âœ… äºˆæ¸¬åˆ†æï¼ˆå£²ä¸Šäºˆæ¸¬ãƒ»éœ€è¦äºˆæ¸¬ï¼‰
âœ… A/Bãƒ†ã‚¹ãƒˆçµæœåˆ†æ

ã€æ–°è¦APIã€‘
- GET /api/v1/analytics/realtime-sales - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å£²ä¸Š
- GET /api/v1/analytics/customer-behavior - é¡§å®¢è¡Œå‹•åˆ†æ
- GET /api/v1/analytics/staff-performance - ã‚¹ã‚¿ãƒƒãƒ•åˆ†æ
- GET /api/v1/analytics/predictions - äºˆæ¸¬åˆ†æãƒ‡ãƒ¼ã‚¿
- GET /api/v1/analytics/ab-test-results - A/Bãƒ†ã‚¹ãƒˆçµæœ
```

#### 5. ğŸ¤– AIæ©Ÿèƒ½çµ±åˆãƒ»å¼·åŒ–
```typescript
// å®Ÿè£…å¯¾è±¡: æ—¢å­˜Instanceæ©Ÿèƒ½ã®å¼·åŒ–ãƒ»çµ±åˆ
ã€å¼·åŒ–å†…å®¹ã€‘
âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ç²¾åº¦å‘ä¸Šï¼ˆInstance Aå¼·åŒ–ï¼‰
âœ… äºˆç´„æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ”¹å–„ï¼ˆInstance Bå¼·åŒ–ï¼‰
âœ… é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç²¾åº¦å‘ä¸Šï¼ˆInstance Då¼·åŒ–ï¼‰
âœ… æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®å®šæœŸå†å­¦ç¿’æ©Ÿèƒ½
âœ… AIäºˆæ¸¬ç²¾åº¦ã®ç›£è¦–ãƒ»æ”¹å–„ã‚·ã‚¹ãƒ†ãƒ 

ã€æ–°è¦æ©Ÿèƒ½ã€‘
- å£²ä¸Šäºˆæ¸¬AIï¼ˆå­£ç¯€æ€§ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰è€ƒæ…®ï¼‰
- é¡§å®¢é›¢è„±äºˆæ¸¬AIï¼ˆãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼‰
- åœ¨åº«æœ€é©åŒ–AIï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ææ–™ç®¡ç†ï¼‰
```

#### 6. âš¡ å¤–éƒ¨APIçµ±åˆå¼·åŒ–
```typescript
// å®Ÿè£…å¯¾è±¡: src/services/externalApiService.ts å¤§å¹…æ‹¡å¼µ
ã€çµ±åˆå¯¾è±¡ã€‘
âœ… Instagram Graph API - æœ¬æ ¼é€£æºï¼ˆæŠ•ç¨¿ãƒ»DMç®¡ç†ï¼‰
âœ… LINE Messaging API - é«˜åº¦æ©Ÿèƒ½æ´»ç”¨
âœ… Google Calendar API - åŒæ–¹å‘åŒæœŸå¼·åŒ–
âœ… Hot Pepper Beauty API - å®Œå…¨çµ±åˆ
âœ… æ±ºæ¸ˆAPIçµ±åˆï¼ˆStripe/Squareï¼‰

ã€æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‘
- POST /api/v1/external/instagram/sync - Instagram ãƒ‡ãƒ¼ã‚¿åŒæœŸ
- POST /api/v1/external/line/rich-menu - LINE ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†
- POST /api/v1/external/payments/process - æ±ºæ¸ˆå‡¦ç†
```

---

## ğŸ› ï¸ æŠ€è¡“å®Ÿè£…ä»•æ§˜

### ğŸ“¦ è¿½åŠ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```json
{
  "performance": {
    "compression": "gzipåœ§ç¸®",
    "clustering": "Node.js cluster mode",
    "caching": "Redis å¤šå±¤ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°",
    "monitoring": "Prometheus + Grafana"
  },
  "database": {
    "connection-pooling": "Prisma connection pool",
    "query-optimization": "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–",
    "caching": "Redis query cache",
    "migration": "è‡ªå‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"
  },
  "security": {
    "rate-limiting": "express-rate-limit",
    "encryption": "bcryptjs + AES-256",
    "monitoring": "Real-time threat detection",
    "audit": "Complete audit trail"
  }
}
```

### ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
// src/middleware/performance.ts
import prometheus from 'prom-client'

const httpDuration = new prometheus.Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status']
})

export const performanceMiddleware = (req, res, next) => {
  const start = Date.now()
  
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000
    httpDuration.observe(
      { method: req.method, route: req.route?.path, status: res.statusCode },
      duration
    )
  })
  
  next()
}
```

### ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–æˆ¦ç•¥
```prisma
// prisma/schema.prisma - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ä¾‹
model Reservation {
  id        Int      @id @default(autoincrement())
  date      DateTime
  customerId Int
  staffId   Int
  
  // æœ€é©åŒ–ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([date]) // æ—¥ä»˜æ¤œç´¢æœ€é©åŒ–
  @@index([customerId]) // é¡§å®¢åˆ¥æ¤œç´¢æœ€é©åŒ–
  @@index([staffId, date]) // ã‚¹ã‚¿ãƒƒãƒ•Ã—æ—¥ä»˜è¤‡åˆæ¤œç´¢
  @@index([date, customerId, staffId]) // è¤‡åˆæ¡ä»¶æœ€é©åŒ–
}
```

### âš¡ ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥
```typescript
// src/utils/cache.ts
import Redis from 'ioredis'

class CacheManager {
  private redis = new Redis(process.env.REDIS_URL)
  
  // éšå±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  async getWithFallback<T>(
    key: string,
    fallback: () => Promise<T>,
    ttl: number = 300
  ): Promise<T> {
    // L1: ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
    const memoryCache = this.memoryCache.get(key)
    if (memoryCache) return memoryCache
    
    // L2: Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    const redisCache = await this.redis.get(key)
    if (redisCache) {
      const data = JSON.parse(redisCache)
      this.memoryCache.set(key, data, 60) // 1åˆ†ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
      return data
    }
    
    // L3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    const data = await fallback()
    await this.redis.setex(key, ttl, JSON.stringify(data))
    this.memoryCache.set(key, data, 60)
    return data
  }
}
```

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… Phase 1ï¼ˆ1æ—¥ç›®ï¼‰- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºç›¤
- [ ] **é–‹ç™ºç’°å¢ƒæ§‹ç¯‰**
  - [ ] team-b-backendãƒ–ãƒ©ãƒ³ãƒä½œæˆãƒ»åˆ‡ã‚Šæ›¿ãˆ
  - [ ] Redis ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
  - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ç’°å¢ƒæ§‹ç¯‰
  
- [ ] **API ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
  - [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›£è¦–ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…
  - [ ] Redis ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°å¼·åŒ–
  - [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæœ€é©åŒ–
  - [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–å®Ÿè£…
  
- [ ] **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**
  - [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¼·åŒ–å®Ÿè£…
  - [ ] ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
  - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°å¼·åŒ–

### âœ… Phase 2ï¼ˆ2æ—¥ç›®ï¼‰- åˆ†æãƒ»AIæ©Ÿèƒ½å¼·åŒ–
- [ ] **é«˜åº¦åˆ†ææ©Ÿèƒ½**
  - [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å£²ä¸Šåˆ†æAPI
  - [ ] é¡§å®¢è¡Œå‹•åˆ†æã‚·ã‚¹ãƒ†ãƒ 
  - [ ] ã‚¹ã‚¿ãƒƒãƒ•ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
  
- [ ] **AIæ©Ÿèƒ½çµ±åˆå¼·åŒ–**
  - [ ] æ—¢å­˜Instanceæ©Ÿèƒ½æ”¹å–„
  - [ ] æ–°è¦äºˆæ¸¬AIå®Ÿè£…
  - [ ] æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–

### âœ… Phase 3ï¼ˆ3æ—¥ç›®ï¼‰- å¤–éƒ¨é€£æºãƒ»çµ±åˆ
- [ ] **å¤–éƒ¨APIçµ±åˆ**
  - [ ] Instagram Graph APIæœ¬æ ¼é€£æº
  - [ ] æ±ºæ¸ˆAPIçµ±åˆå®Ÿè£…
  - [ ] Hot Pepper Beauty APIå®Œå…¨çµ±åˆ
  
- [ ] **ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ**
  - [ ] å…¨æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ
  - [ ] è² è·ãƒ†ã‚¹ãƒˆå®Ÿæ–½
  - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™å€¤ç¢ºèª

---

## ğŸ”— ä»–ãƒãƒ¼ãƒ é€£æºä»•æ§˜

### ãƒãƒ¼ãƒ Aï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã¸ã® APIæä¾›
```typescript
// æ–°è¦APIä»•æ§˜ä¾‹
interface APISpecification {
  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æãƒ‡ãƒ¼ã‚¿
  '/api/v1/analytics/realtime-dashboard': {
    method: 'GET',
    response: {
      sales: { today: number, thisWeek: number, thisMonth: number },
      reservations: { today: number, upcoming: number },
      messages: { unread: number, urgent: number },
      performance: { avgResponseTime: number, uptime: number }
    }
  },
  
  // é«˜åº¦ãªäºˆç´„æœ€é©åŒ–
  '/api/v1/reservations/advanced-optimize': {
    method: 'POST',
    body: { customerId: number, preferences: object },
    response: {
      suggestions: Array<{
        datetime: string,
        staffId: number,
        confidence: number,
        reasoning: string[]
      }>
    }
  }
}
```

### ãƒãƒ¼ãƒ Cï¼ˆQAï¼‰ã¸ã®æ¸¬å®šãƒ‡ãƒ¼ã‚¿æä¾›
```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›
interface PerformanceMetrics {
  apiResponseTimes: Record<string, number[]>
  memoryUsage: { rss: number, heapUsed: number, external: number }
  databaseMetrics: { connectionPool: number, slowQueries: string[] }
  cacheHitRates: Record<string, number>
  errorRates: Record<string, number>
}

// ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.get('/metrics', async (req, res) => {
  res.set('Content-Type', prometheus.register.contentType)
  res.end(await prometheus.register.metrics())
})
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™ãƒ»KPI

### ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ KPI
| æŒ‡æ¨™ | ç¾åœ¨å€¤ | ç›®æ¨™å€¤ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **APIå¿œç­”æ™‚é–“** | 200ms | < 100ms | 50%å‘ä¸Š |
| **åŒæ™‚æ¥ç¶šæ•°** | 100 | 500+ | 5å€å‘ä¸Š |
| **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡** | 512MB | < 400MB | 20%å‰Šæ¸› |
| **CPUä½¿ç”¨ç‡** | 15% | < 25% | ä½™è£•åº¦å‘ä¸Š |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡** | 70% | > 90% | 20%å‘ä¸Š |

### ğŸ” å“è³ªæŒ‡æ¨™
| æŒ‡æ¨™ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------|--------|----------|
| **APIå¯ç”¨æ€§** | 99.9% | ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ç›£è¦– |
| **ã‚¨ãƒ©ãƒ¼ç‡** | < 0.1% | ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°åˆ†æ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢** | Aè©•ä¾¡ | OWASPåŸºæº– |
| **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸** | 80%+ | Jestæ¸¬å®š |

---

## ğŸš¨ æŠ€è¡“åˆ¶ç´„ãƒ»æ³¨æ„äº‹é …

### âš ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ¶ç´„
- **ãƒ¡ãƒ¢ãƒªåˆ¶é™**: é–‹ç™ºç’°å¢ƒ 512MB / æœ¬ç•ªç’°å¢ƒ 2GB
- **CPUåˆ¶é™**: ã‚·ãƒ³ã‚°ãƒ«ã‚³ã‚¢åŸºæº–ã§æœ€é©åŒ–
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·100msæƒ³å®šã§ã®è¨­è¨ˆ

### âš ï¸ æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®äº’æ›æ€§
- **æ—¢å­˜API**: æ—¢å­˜46ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®äº’æ›æ€§ç¶­æŒå¿…é ˆ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œãƒ»å¤‰æ›ä¸è¦
- **èªè¨¼**: æ—¢å­˜JWT/2FAèªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ´»ç”¨

### âš ï¸ å¤–éƒ¨APIåˆ¶ç´„
- **Instagram**: Graph API rate limit - 200calls/hour
- **LINE**: Messaging API limit - 1000messages/month (ãƒ•ãƒªãƒ¼)
- **Google Calendar**: API quota - 1,000,000requests/day

---

## ğŸ”§ é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°æ”¯æ´

### ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°è¨­å®š
```typescript
// è©³ç´°ãƒ­ã‚°è¨­å®š
// src/utils/logger.ts
import winston from 'winston'

export const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
})
```

### ğŸ§ª è² è·ãƒ†ã‚¹ãƒˆè¨­å®š
```bash
# Artillery.js ã‚’ä½¿ç”¨ã—ãŸè² è·ãƒ†ã‚¹ãƒˆ
npm install -g artillery

# è² è·ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
artillery run --target http://localhost:4002 loadtest.yml

# loadtest.yml è¨­å®šä¾‹
config:
  target: 'http://localhost:4002'
  phases:
    - duration: 60
      arrivalRate: 10
    - duration: 120
      arrivalRate: 50
scenarios:
  - name: "API Load Test"
    requests:
      - get:
          url: "/api/v1/analytics/dashboard"
      - post:
          url: "/api/v1/reservations/optimize"
          json:
            customerId: 1
            date: "2024-12-25"
```

---

## ğŸ“ ç·Šæ€¥æ™‚ãƒ»ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ğŸš¨ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œå¯¾å¿œ
1. **å³åº§å¯¾å¿œ**:
   - ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªæ¤œå‡ºæ™‚ â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ãƒ»ã‚¯ã‚¨ãƒªæœ€é©åŒ–
   - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯æ¤œå‡ºæ™‚ â†’ ãƒ—ãƒ­ã‚»ã‚¹å†èµ·å‹•ãƒ»åŸå› èª¿æŸ»
   - API ã‚¨ãƒ©ãƒ¼æ€¥å¢—æ™‚ â†’ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°åˆ†æãƒ»ç·Šæ€¥ä¿®æ­£

2. **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŸºæº–**:
   - APIå¿œç­”æ™‚é–“ > 500ms ãŒ5åˆ†ç¶™ç¶š
   - ã‚¨ãƒ©ãƒ¼ç‡ > 1% ãŒç¶™ç¶š
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ > 80% ç¶™ç¶š

### ğŸ”§ æŠ€è¡“ã‚µãƒãƒ¼ãƒˆ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å•é¡Œ**: DBA ãƒ¬ãƒ™ãƒ«ã®æœ€é©åŒ–ç›¸è«‡
- **Redisæ¥ç¶šå•é¡Œ**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥è¦‹ç›´ã—
- **å¤–éƒ¨APIå•é¡Œ**: API provider ã¸ã®å•ã„åˆã‚ã›

### ğŸ“‹ æ—¥æ¬¡é€²æ—å ±å‘Š
```markdown
## ãƒãƒ¼ãƒ Bæ—¥æ¬¡å ±å‘Šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- **APIå¿œç­”æ™‚é–“**: [ç¾åœ¨å€¤] â†’ [ç›®æ¨™å€¤] ([æ”¹å–„ç‡])
- **å®Ÿè£…å®Œäº†æ©Ÿèƒ½**: [æ–°æ©Ÿèƒ½ãƒ»æœ€é©åŒ–é …ç›®]

### æŠ€è¡“çš„èª²é¡Œ
- **è§£æ±ºã—ãŸå•é¡Œ**: [è§£æ±ºæ¸ˆã¿æŠ€è¡“èª²é¡Œ]
- **ç¾åœ¨ã®èª²é¡Œ**: [å¯¾å¿œä¸­ãƒ»èª¿æŸ»ä¸­ã®èª²é¡Œ]
- **å¤–éƒ¨ä¾å­˜**: [ä»–ãƒãƒ¼ãƒ ãƒ»å¤–éƒ¨APIã¸ã®ä¾å­˜äº‹é …]

### æ˜æ—¥ã®è¨ˆç”»
- **å„ªå…ˆå®Ÿè£…**: [ç¿Œæ—¥ã®æœ€å„ªå…ˆã‚¿ã‚¹ã‚¯]
- **æ¤œè¨¼é …ç›®**: [ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼äºˆå®šé …ç›®]
```

---

## ğŸ‰ æˆåŠŸã®å®šç¾©

### âœ… æœ€çµ‚æˆæœç‰©
1. **é«˜æ€§èƒ½APIã‚µãƒ¼ãƒãƒ¼**: å…¨KPIç›®æ¨™å€¤ã‚¯ãƒªã‚¢
2. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: 500+åŒæ™‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ
3. **åŒ…æ‹¬çš„ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ **: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«å¯¾å¿œ
5. **AIæ©Ÿèƒ½å¼·åŒ–**: ç²¾åº¦ãƒ»æ€§èƒ½å¤§å¹…å‘ä¸Š

### ğŸš€ é‹ç”¨æº–å‚™
- **è² è·ãƒ†ã‚¹ãƒˆ**: ç›®æ¨™å€¤ã§ã®å®‰å®šç¨¼åƒç¢ºèª
- **ç›£è¦–è¨­å®š**: Prometheus/Grafana ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ§‹ç¯‰
- **é‹ç”¨æ‰‹é †æ›¸**: éšœå®³å¯¾å¿œãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ‰‹é †å®Œå‚™
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°**: æœ¬ç•ªç’°å¢ƒæœ€é©åŒ–å®Œäº†

---

**ğŸ¯ ãƒãƒ¼ãƒ BãƒŸãƒƒã‚·ãƒ§ãƒ³**: ç¾å®¹å®¤æ¥­ç•Œæœ€é«˜æ°´æº–ã®é«˜æ€§èƒ½ãƒ»é«˜å“è³ªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿç¾ã™ã‚‹

**ğŸ“… å®ŒæˆæœŸé™**: 2024å¹´12æœˆ28æ—¥ 18:00  
**ğŸ”— é€£æºãƒãƒ¼ãƒ **: ãƒãƒ¼ãƒ Aï¼ˆAPIä»•æ§˜ï¼‰ã€ãƒãƒ¼ãƒ Cï¼ˆå“è³ªä¿è¨¼ï¼‰

> âš¡ **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å°‚é–€æ€§ã‚’çµé›†ã—ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§å …ç‰¢ãªã‚·ã‚¹ãƒ†ãƒ åŸºç›¤ã‚’ç¯‰ãä¸Šã’ã¾ã—ã‚‡ã†ï¼**
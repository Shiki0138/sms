// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ãƒ†ãƒŠãƒ³ãƒˆï¼ˆåº—èˆ—ï¼‰- ç¾å®¹å®¤æ¥­å‹™æœ€é©åŒ–ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»˜ã
model Tenant {
  id          String   @id @default(cuid())
  name        String
  address     String?
  phone       String?
  email       String?
  plan        String   @default("light") // light, standard, premium_ai
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  staff        Staff[]
  customers    Customer[]
  threads      MessageThread[]
  reservations Reservation[]
  templates    Template[]
  auditLogs    AuditLog[]
  settings     TenantSetting[]
  tags         Tag[]
  autoMessageTemplates AutoMessageTemplate[]
  autoMessageLogs      AutoMessageLog[]
  menus                Menu[]
  menuCategories       MenuCategory[]
  menuHistory          MenuHistory[]
  recommendations      MenuRecommendation[]
  notifications        Notification[]
  analyticsMetrics     AnalyticsMetric[]
  predictionData       PredictionData[]
  customerBehaviors    CustomerBehavior[]
  loginHistory         LoginHistory[]
  securityEvents       SecurityEvent[]
  customerPreferences  CustomerPreference[]
  marketingCampaigns   MarketingCampaign[]
  staffPerformance     StaffPerformance[]
  payments             Payment[]
  subscription         Subscription?
  invoices             Invoice[]
  feedback             Feedback[]
  quickRatings         QuickRating[]
  tenantFeatureFlags   TenantFeatureFlag[]
  // supportRequests      SupportRequest[]
  // supportAvailability  SupportAvailability[]
  salaryDashboards     SalaryDashboard[]
  incentiveRules       IncentiveRule[]
  staffAchievements    StaffAchievement[]
  businessMetrics      BusinessMetrics[]
  competitorAnalyses   CompetitorAnalysis[]
  strategicActions     StrategicAction[]
  businessInsights     BusinessInsight[]
  businessGoals        BusinessGoal[]
  managementReports    ManagementReport[]
  supportStaffRequests SupportStaffRequest[]

  // ğŸ’« ç¾å®¹å®¤æ¥­å‹™é«˜é€ŸåŒ–ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([isActive]) // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åº—èˆ—æ¤œç´¢æœ€é©åŒ–
  @@index([plan, isActive]) // ãƒ—ãƒ©ãƒ³åˆ¥æ¤œç´¢æœ€é©åŒ–
  @@map("tenants")
}

// ãƒ†ãƒŠãƒ³ãƒˆè¨­å®š
model TenantSetting {
  id        String   @id @default(cuid())
  tenantId  String
  key       String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@unique([tenantId, key])
  @@map("tenant_settings")
}

// ã‚¹ã‚¿ãƒƒãƒ•
model Staff {
  id           String    @id @default(cuid())
  email        String    @unique
  password     String
  name         String
  role         String    @default("STAFF") // ADMIN, MANAGER, STAFF
  isActive     Boolean   @default(true)
  lastLoginAt  DateTime?
  tenantId     String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // 2FAé–¢é€£
  twoFactorEnabled Boolean @default(false)
  twoFactorSecret  String?
  backupCodes      String? // JSONé…åˆ—å½¢å¼
  
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  refreshTokens    RefreshToken[]
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
  loginAttempts    Int      @default(0)
  lockedUntil      DateTime?
  passwordResetToken String?
  passwordResetExpires DateTime?

  // Relations
  tenant                  Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignedThreads         MessageThread[] @relation("AssignedStaff")
  sentMessages            Message[]
  handledReservations     Reservation[]   @relation("HandledBy")
  createdTemplates        Template[]
  auditLogs               AuditLog[]
  notifications           Notification[]
  loginHistory            LoginHistory[] @relation("LoginHistory")
  securityEvents          SecurityEvent[] @relation("SecurityEvents")
  staffPerformance        StaffPerformance[]
  preferredByCustomers    Customer[] @relation("PreferredStaff")
  // supportRequests         SupportRequest[] @relation("SupportRequester")
  // supportAvailability     SupportAvailability[] @relation("SupportStaff")
  // supportResponses        SupportResponse[] @relation("SupportResponder")
  // supportAsSupporter      SupportMatch[] @relation("Supporter")
  // supportAsRequester      SupportMatch[] @relation("Requester")
  salaryDashboards        SalaryDashboard[] @relation("SalaryDashboard")
  dailySalaryRecords      DailySalaryRecord[] @relation("DailySalaryRecord")
  staffAchievements       StaffAchievement[] @relation("StaffAchievement")
  supportStaffRequests    SupportStaffRequest[] @relation("SupportStaffRequester")

  @@map("staff")
}

// enum StaffRole {
//   ADMIN
//   MANAGER
//   STAFF
// }
// SQLite doesn't support enums, using String instead

// é¡§å®¢ - ç¾å®¹å®¤ã‚¹ã‚¿ãƒƒãƒ•ã®å¿ƒã‚’èª­ã‚€è¶…é«˜é€Ÿæ¤œç´¢å¯¾å¿œ
model Customer {
  id              String    @id @default(cuid())
  name            String?
  nameKana        String?
  gender          String? // MALE, FEMALE, OTHER
  birthDate       DateTime?
  phone           String?
  email           String?
  address         String?
  instagramId     String?   @unique
  lineId          String?   @unique
  firstVisitDate  DateTime?
  lastVisitDate   DateTime?
  visitCount      Int       @default(0)
  totalSpent      Decimal?  @default(0)
  notes           String?
  segment         String?   // VIP, REGULAR, NEW, CHURNED
  lifetimeValue   Decimal?  @default(0)
  riskScore       Int?      @default(0)
  preferredStaffId String?
  profilePhoto     String?
  source          String?   // HOTPEPPER, GOOGLE, REFERRAL, WALK_IN
  isActive        Boolean   @default(true)
  tenantId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  tenant       Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  threads      MessageThread[]
  reservations Reservation[]
  customerTags CustomerTag[]
  autoMessageLogs AutoMessageLog[]
  menuHistory  MenuHistory[]
  recommendations MenuRecommendation[]
  notifications Notification[]
  customerBehavior CustomerBehavior?
  customerPreferences CustomerPreference[]
  preferredStaff Staff? @relation("PreferredStaff", fields: [preferredStaffId], references: [id], onDelete: SetNull)

  // ğŸ’ ç¾å®¹å®¤ã‚¹ã‚¿ãƒƒãƒ•ãŒæ„Ÿå‹•ã™ã‚‹é«˜é€Ÿé¡§å®¢æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([tenantId]) // åº—èˆ—åˆ¥é¡§å®¢ä¸€è¦§ã®ç¬é–“è¡¨ç¤º
  @@index([tenantId, name]) // åå‰æ¤œç´¢ã®é›»å…‰çŸ³ç«å¯¾å¿œ
  @@index([tenantId, phone]) // é›»è©±ç•ªå·æ¤œç´¢ã®å³åº§å¯¾å¿œ
  @@index([tenantId, email]) // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œç´¢ã®é«˜é€ŸåŒ–
  @@index([tenantId, lastVisitDate]) // æœ€çµ‚æ¥åº—æ—¥é †ã‚½ãƒ¼ãƒˆã®æœ€é©åŒ–
  @@index([tenantId, visitCount]) // ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼é †è¡¨ç¤ºã®é«˜é€ŸåŒ–
  @@index([tenantId, createdAt]) // æ–°è¦é¡§å®¢é †è¡¨ç¤ºã®æœ€é©åŒ–
  @@index([instagramId]) // Instagramé€£æºã®ç¬é–“æ¤œç´¢
  @@index([lineId]) // LINEé€£æºã®ç¬é–“æ¤œç´¢
  @@index([tenantId, birthDate]) // èª•ç”Ÿæ—¥æœˆæ¤œç´¢ã®é«˜é€ŸåŒ–
  @@map("customers")
}

// enum Gender {
//   MALE
//   FEMALE
//   OTHER
// }
// SQLite doesn't support enums, using String instead

// ã‚¿ã‚°
model Tag {
  id          String @id @default(cuid())
  name        String
  color       String @default("#3B82F6")
  type        String // CUSTOMER, THREAD
  tenantId    String
  createdAt   DateTime @default(now())

  // Relations
  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  customerTags CustomerTag[]
  threadTags   ThreadTag[]

  @@unique([tenantId, name, type])
  @@map("tags")
}

// enum TagType {
//   CUSTOMER
//   THREAD
// }
// SQLite doesn't support enums, using String instead

// é¡§å®¢ã‚¿ã‚°ã®ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
model CustomerTag {
  customerId String
  tagId      String
  createdAt  DateTime @default(now())

  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  tag      Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([customerId, tagId])
  @@map("customer_tags")
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ãƒ¬ãƒƒãƒ‰ - ç¾å®¹å®¤ã‚¹ã‚¿ãƒƒãƒ•ã®å¿ƒã«éŸ¿ãé«˜é€Ÿãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†
model MessageThread {
  id                String            @id @default(cuid())
  customerId        String?
  channel           String // INSTAGRAM, LINE
  channelThreadId   String            // Instagram thread ID or LINE user ID
  assignedStaffId   String?
  status            String            @default("OPEN") // OPEN, IN_PROGRESS, CLOSED
  aiAnalyzed        Boolean           @default(false)
  sentimentScore    Float?            // -1.0 to 1.0
  priorityLevel     Int               @default(3) // 1=high, 2=medium, 3=low
  autoReplyEnabled  Boolean           @default(true)
  tenantId          String
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  tenant        Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  customer      Customer?   @relation(fields: [customerId], references: [id], onDelete: SetNull)
  assignedStaff Staff?      @relation("AssignedStaff", fields: [assignedStaffId], references: [id], onDelete: SetNull)
  messages      Message[]
  threadTags    ThreadTag[]

  // ğŸ’Œ ç¾å®¹å®¤ã‚¹ã‚¿ãƒƒãƒ•ãŒæ„›ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†é«˜é€ŸåŒ–ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@unique([tenantId, channel, channelThreadId])
  @@index([tenantId]) // åº—èˆ—åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ã®ç¬é–“è¡¨ç¤º
  @@index([tenantId, status]) // å¯¾å¿œçŠ¶æ³åˆ¥è¡¨ç¤ºã®é«˜é€ŸåŒ–
  @@index([tenantId, assignedStaffId]) // æ‹…å½“è€…åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é›»å…‰çŸ³ç«è¡¨ç¤º
  @@index([tenantId, customerId]) // é¡§å®¢åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã®å³åº§è¡¨ç¤º
  @@index([tenantId, channel]) // ãƒãƒ£ãƒãƒ«åˆ¥è¡¨ç¤ºã®æœ€é©åŒ–
  @@index([tenantId, createdAt]) // æ™‚ç³»åˆ—è¡¨ç¤ºã®é«˜é€ŸåŒ–
  @@index([tenantId, updatedAt]) // æœ€çµ‚æ›´æ–°é †è¡¨ç¤ºã®æœ€é©åŒ–
  @@index([status, updatedAt]) // æœªå¯¾å¿œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å„ªå…ˆè¡¨ç¤º
  @@map("message_threads")
}

// enum MessageChannel {
//   INSTAGRAM
//   LINE
// }
// enum ThreadStatus {
//   OPEN
//   IN_PROGRESS
//   CLOSED
// }
// SQLite doesn't support enums, using String instead

// ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚°ã®ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
model ThreadTag {
  threadId  String
  tagId     String
  createdAt DateTime @default(now())

  thread MessageThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  tag    Tag           @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([threadId, tagId])
  @@map("thread_tags")
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
model Message {
  id           String      @id @default(cuid())
  threadId     String
  senderId     String?     // Staff ID if sent by staff, null if sent by customer
  senderType   String // CUSTOMER, STAFF
  content      String
  mediaType    String      @default("TEXT") // TEXT, IMAGE, STICKER, FILE
  mediaUrl     String?
  externalId   String?     // External platform message ID
  isRead       Boolean     @default(false)
  createdAt    DateTime    @default(now())

  // Relations
  thread MessageThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  sender Staff?        @relation(fields: [senderId], references: [id], onDelete: SetNull)

  @@map("messages")
}

// enum SenderType {
//   CUSTOMER
//   STAFF
// }
// enum MediaType {
//   TEXT
//   IMAGE
//   STICKER
//   FILE
// }
// SQLite doesn't support enums, using String instead

// äºˆç´„
model Reservation {
  id            String            @id @default(cuid())
  startTime     DateTime
  endTime       DateTime?
  menuContent   String?
  serviceContent String?           // ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹
  customerName  String?           // Hot Pepper ãªã©ã®å ´åˆã€Customer ã¨ç´ä»˜ã‹ãªã„å ´åˆã‚‚ã‚ã‚‹
  customerId    String?
  customerPhone String?
  customerEmail String?
  staffId       String?
  source        String // HOTPEPPER, GOOGLE_CALENDAR, PHONE, WALK_IN, MANUAL
  sourceId      String?           // External system ID
  status        String            @default("CONFIRMED") // TENTATIVE, CONFIRMED, COMPLETED, CANCELLED, NO_SHOW
  notes         String?
  totalAmount   Decimal?          @default(0)
  paymentStatus String?           @default("pending") // pending, paid, refunded, failed
  paymentId     String?           // Provider payment ID
  estimatedDuration Int?           // in minutes
  profitMargin  Decimal?          // percentage
  weatherImpact String?           // SUNNY, RAINY, CLOUDY, etc.
  sourceCampaign String?          // marketing campaign reference
  reminderSent  Boolean           @default(false)
  tenantId      String
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  nextVisitDate     DateTime?
  reminderSentAt    DateTime?
  followUpSentAt    DateTime?
  
  // æ–½è¡“å†™çœŸ
  beforePhotos      String?           // JSON array of before photo URLs
  afterPhotos       String?           // JSON array of after photo URLs
  stylistNotes      String?           // ç¾å®¹å¸«ãƒ¡ãƒ¢

  // Relations
  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
  staff    Staff?    @relation("HandledBy", fields: [staffId], references: [id], onDelete: SetNull)
  autoMessageLogs AutoMessageLog[]

  // ğŸ“… ç¾å®¹å®¤ã‚¹ã‚¿ãƒƒãƒ•ãŒæ™‚é–“ã®é­”æ³•ä½¿ã„ã«ãªã‚‹äºˆç´„ç®¡ç†é«˜é€ŸåŒ–ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([tenantId]) // åº—èˆ—åˆ¥äºˆç´„ä¸€è¦§ã®ç¬é–“è¡¨ç¤º
  @@index([tenantId, startTime]) // æ—¥ä»˜åˆ¥äºˆç´„è¡¨ç¤ºã®é›»å…‰çŸ³ç«å¯¾å¿œ
  @@index([tenantId, status]) // äºˆç´„çŠ¶æ³åˆ¥è¡¨ç¤ºã®é«˜é€ŸåŒ–
  @@index([tenantId, staffId]) // ã‚¹ã‚¿ãƒƒãƒ•åˆ¥äºˆç´„ã®å³åº§è¡¨ç¤º
  @@index([tenantId, customerId]) // é¡§å®¢åˆ¥äºˆç´„å±¥æ­´ã®ç¬é–“è¡¨ç¤º
  @@index([tenantId, startTime, status]) // æ—¥ä»˜Ã—çŠ¶æ³è¤‡åˆæ¤œç´¢ã®æœ€é©åŒ–
  @@index([tenantId, staffId, startTime]) // ã‚¹ã‚¿ãƒƒãƒ•ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºã®é«˜é€ŸåŒ–
  @@index([startTime, endTime]) // æ™‚é–“ç¯„å›²æ¤œç´¢ã®æœ€é©åŒ–
  @@index([status, startTime]) // ä»Šæ—¥ã®äºˆç´„çŠ¶æ³ã®é«˜é€Ÿè¡¨ç¤º
  @@index([tenantId, source]) // äºˆç´„çµŒè·¯åˆ¥åˆ†æã®æœ€é©åŒ–
  @@index([tenantId, nextVisitDate]) // æ¬¡å›äºˆç´„ææ¡ˆã®é«˜é€ŸåŒ–
  @@index([reminderSentAt]) // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼é€ä¿¡ç®¡ç†ã®æœ€é©åŒ–
  @@map("reservations")
}

// enum ReservationSource {
//   HOTPEPPER
//   GOOGLE_CALENDAR
//   PHONE
//   WALK_IN
//   MANUAL
// }
// enum ReservationStatus {
//   TENTATIVE
//   CONFIRMED
//   COMPLETED
//   CANCELLED
//   NO_SHOW
// }
// SQLite doesn't support enums, using String instead

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
model Template {
  id          String   @id @default(cuid())
  title       String
  content     String
  category    String?
  createdById String
  tenantId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant    Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdBy Staff  @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@map("templates")
}

// ç›£æŸ»ãƒ­ã‚°
model AuditLog {
  id          String   @id @default(cuid())
  action      String
  entityType  String
  entityId    String?
  description String?
  staffId     String?
  ipAddress   String?
  userAgent   String?
  tenantId    String
  createdAt   DateTime @default(now())

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  staff  Staff? @relation(fields: [staffId], references: [id], onDelete: SetNull)

  @@map("audit_logs")
}

// è‡ªå‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
model AutoMessageTemplate {
  id          String   @id @default(cuid())
  type        String   // REMINDER_1_WEEK, REMINDER_3_DAYS, FOLLOWUP_VISIT
  title       String
  content     String
  isActive    Boolean  @default(true)
  tenantId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, type])
  @@map("auto_message_templates")
}

// è‡ªå‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ­ã‚°
model AutoMessageLog {
  id              String   @id @default(cuid())
  reservationId   String?
  customerId      String
  templateType    String   // REMINDER_1_WEEK, REMINDER_3_DAYS, FOLLOWUP_VISIT
  channel         String   // LINE, INSTAGRAM, EMAIL
  messageContent  String
  status          String   // SENT, FAILED, SCHEDULED
  sentAt          DateTime?
  errorMessage    String?
  tenantId        String
  createdAt       DateTime @default(now())

  // Relations
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  customer    Customer     @relation(fields: [customerId], references: [id], onDelete: Cascade)
  reservation Reservation? @relation(fields: [reservationId], references: [id], onDelete: SetNull)

  @@map("auto_message_logs")
}

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ†ã‚´ãƒªãƒ¼
model MenuCategory {
  id          String   @id @default(cuid())
  name        String
  displayOrder Int     @default(0)
  isActive    Boolean  @default(true)
  tenantId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  menus  Menu[]

  @@unique([tenantId, name])
  @@map("menu_categories")
}

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼
model Menu {
  id           String   @id @default(cuid())
  name         String
  description  String?
  price        Int      // å††å˜ä½
  duration     Int      // åˆ†å˜ä½
  categoryId   String
  isActive     Boolean  @default(true)
  displayOrder Int      @default(0)
  tenantId     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // AIæ¨å¥¨ç”¨ãƒ‡ãƒ¼ã‚¿
  popularity     Int @default(0) // äººæ°—åº¦ã‚¹ã‚³ã‚¢
  seasonality    String? // SPRING, SUMMER, AUTUMN, WINTER, ALL
  ageGroup       String? // TEENS, TWENTIES, THIRTIES, FORTIES_PLUS, ALL
  genderTarget   String? // MALE, FEMALE, ALL

  // Relations
  tenant         Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  category       MenuCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  menuHistory    MenuHistory[]
  recommendations MenuRecommendation[]

  @@map("menus")
}

// é¡§å®¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±¥æ­´
model MenuHistory {
  id          String   @id @default(cuid())
  customerId  String
  menuId      String
  visitDate   DateTime
  satisfaction Int?    // 1-5 æº€è¶³åº¦ã‚¹ã‚³ã‚¢
  notes       String?
  tenantId    String
  createdAt   DateTime @default(now())

  // Relations
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  menu     Menu     @relation(fields: [menuId], references: [id], onDelete: Cascade)
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("menu_history")
}

// AIãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨å¥¨
model MenuRecommendation {
  id         String   @id @default(cuid())
  customerId String
  menuId     String
  tenantId   String
  score      Float    // 0.0-1.0 æ¨å¥¨ã‚¹ã‚³ã‚¢
  reasoning  String   // æ¨å¥¨ç†ç”±
  factors    String   // JSONå½¢å¼ã§æ¨å¥¨è¦å› ãƒ‡ãƒ¼ã‚¿
  createdAt  DateTime @default(now())
  expiresAt  DateTime // æ¨å¥¨ã®æœ‰åŠ¹æœŸé™

  // Relations
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  menu     Menu     @relation(fields: [menuId], references: [id], onDelete: Cascade)
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("menu_recommendations")
}

// é€šçŸ¥
model Notification {
  id         String   @id @default(cuid())
  type       String   // NEW_MESSAGE, RESERVATION_CHANGE, URGENT_ALERT, SYSTEM_NOTIFICATION
  title      String
  message    String
  tenantId   String
  staffId    String?
  customerId String?
  metadata   String?  // JSONå½¢å¼ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
  priority   String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  isRead     Boolean  @default(false)
  readAt     DateTime?
  createdAt  DateTime @default(now())

  // Relations
  tenant   Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  staff    Staff?     @relation(fields: [staffId], references: [id], onDelete: SetNull)
  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)

  @@index([tenantId, isRead])
  @@index([staffId, isRead])
  @@map("notifications")
}

// åˆ†æãƒ¡ãƒˆãƒªã‚¯ã‚¹
model AnalyticsMetric {
  id        String   @id @default(cuid())
  tenantId  String
  metricKey String   // revenue_daily, customers_new, reservations_count, etc.
  value     Float
  date      DateTime
  metadata  String?  // JSONå½¢å¼ã§è©³ç´°ãƒ‡ãƒ¼ã‚¿
  createdAt DateTime @default(now())

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, metricKey, date])
  @@index([tenantId, metricKey])
  @@index([date])
  @@map("analytics_metrics")
}

// äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿
model PredictionData {
  id           String   @id @default(cuid())
  tenantId     String
  predictionType String // revenue_forecast, customer_churn, demand_forecast
  targetDate   DateTime
  predictedValue Float
  confidence   Float    // 0.0-1.0 ä¿¡é ¼åº¦
  actualValue  Float?   // å¾Œã‹ã‚‰å®Ÿç¸¾å€¤ã‚’è¨˜éŒ²
  features     String   // JSONå½¢å¼ã§äºˆæ¸¬ã«ä½¿ç”¨ã—ãŸç‰¹å¾´é‡
  modelVersion String   @default("v1.0")
  createdAt    DateTime @default(now())

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, predictionType, targetDate, modelVersion])
  @@index([tenantId, predictionType])
  @@index([targetDate])
  @@map("prediction_data")
}

// é¡§å®¢è¡Œå‹•åˆ†æ
model CustomerBehavior {
  id                String   @id @default(cuid())
  customerId        String
  tenantId          String
  lastVisitDate     DateTime?
  visitFrequency    Float?   // å¹³å‡æ¥åº—é–“éš”ï¼ˆæ—¥ï¼‰
  averageSpending   Float?   // å¹³å‡å®¢å˜ä¾¡
  preferredTimeSlot String?  // å¥½ã¿ã®æ™‚é–“å¸¯
  churnProbability  Float?   // 0.0-1.0 é›¢è„±ç¢ºç‡
  lifetimeValue     Float?   // é¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤
  riskScore         Float?   // 0.0-1.0 ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢
  updatedAt         DateTime @updatedAt
  createdAt         DateTime @default(now())

  // Relations
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([customerId])
  @@index([tenantId, churnProbability])
  @@index([tenantId, lifetimeValue])
  @@map("customer_behaviors")
}

// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³
model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  staffId   String
  expiresAt DateTime
  createdAt DateTime @default(now())
  isRevoked Boolean  @default(false)
  
  // ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±
  userAgent String?
  ipAddress String?
  
  // Relations
  staff Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)
  
  @@map("refresh_tokens")
}

// ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´
model LoginHistory {
  id         String   @id @default(cuid())
  staffId    String?
  tenantId   String
  email      String
  success    Boolean
  ipAddress  String?
  userAgent  String?
  failReason String?
  createdAt  DateTime @default(now())
  
  // Relations
  staff  Staff?  @relation("LoginHistory", fields: [staffId], references: [id], onDelete: SetNull)
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([staffId])
  @@index([tenantId, createdAt])
  @@map("login_history")
}

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ
model SecurityEvent {
  id          String   @id @default(cuid())
  tenantId    String
  staffId     String?
  eventType   String   // LOGIN_FAILED, ACCOUNT_LOCKED, PASSWORD_RESET, 2FA_ENABLED, etc.
  description String
  ipAddress   String?
  userAgent   String?
  metadata    String?  // JSONå½¢å¼
  severity    String   @default("INFO") // INFO, WARNING, CRITICAL
  createdAt   DateTime @default(now())
  
  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  staff  Staff? @relation("SecurityEvents", fields: [staffId], references: [id], onDelete: SetNull)
  
  @@index([tenantId, severity])
  @@index([eventType])
  @@map("security_events")
}

// é¡§å®¢è¨­å®šãƒ»å¥½ã¿
model CustomerPreference {
  id         Int      @id @default(autoincrement())
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  tenantId   String
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  // è¨­å®šé …ç›®
  preferredStaff    String?
  preferredTime     String?  // "morning", "afternoon", "evening"
  preferredDay      String?  // "monday", "tuesday", etc.
  communicationPref String   @default("LINE") // "LINE", "EMAIL", "SMS"
  
  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¥½ã¿
  favoriteServices  String?  // JSON array
  avoidServices     String?  // JSON array
  
  // ãã®ä»–
  notes            String?
  lastUpdated      DateTime @default(now())
  
  @@unique([customerId, tenantId])
  @@map("customer_preferences")
}

// ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
model MarketingCampaign {
  id          Int      @id @default(autoincrement())
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  name        String
  description String?
  type        String   // "EMAIL", "LINE", "SMS", "PROMOTION"
  status      String   @default("DRAFT") // "DRAFT", "ACTIVE", "COMPLETED", "CANCELLED"
  
  // ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°
  targetSegment     String?  // JSON criteria
  targetCustomerIds String?  // JSON array of customer IDs
  
  // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  scheduledAt    DateTime?
  startDate      DateTime?
  endDate        DateTime?
  
  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  messageContent String
  subject        String?
  
  // çµæœ
  sentCount      Int @default(0)
  openCount      Int @default(0)
  clickCount     Int @default(0)
  responseCount  Int @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("marketing_campaigns")
}

// ã‚¹ã‚¿ãƒƒãƒ•ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
model StaffPerformance {
  id       Int      @id @default(autoincrement())
  staffId  String
  staff    Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  tenantId String
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  // æœŸé–“
  month    Int      // 1-12
  year     Int
  
  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
  totalReservations    Int @default(0)
  totalRevenue         Float @default(0)
  avgServiceTime       Float @default(0) // minutes
  customerSatisfaction Float @default(0) // 1-5 scale
  
  // é¡§å®¢é–¢ä¿‚
  newCustomers     Int @default(0)
  repeatCustomers  Int @default(0)
  referrals        Int @default(0)
  
  // åŠ¹ç‡æ€§
  utilizationRate  Float @default(0) // percentage
  noShowRate       Float @default(0) // percentage
  cancelRate       Float @default(0) // percentage
  
  // æˆé•·
  skillRating      Float @default(0) // 1-5 scale
  trainingHours    Float @default(0)
  certifications   String? // JSON array
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([staffId, month, year])
  @@index([tenantId, year, month])
  @@map("staff_performance")
}

// æ±ºæ¸ˆæƒ…å ±
model Payment {
  id                  String      @id @default(cuid())
  tenantId            String
  tenant              Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  subscriptionId      String?
  subscription        Subscription? @relation(fields: [subscriptionId], references: [id])
  
  // æ±ºæ¸ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±
  provider            String      // stripe, square, paypal, payjp
  providerPaymentId   String      // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å´ã®æ±ºæ¸ˆID
  
  // æ±ºæ¸ˆè©³ç´°
  amount              Float
  currency            String      @default("JPY")
  status              String      // pending, processing, succeeded, failed, canceled, refunded, partially_refunded
  description         String?
  paymentMethodId     String
  failureReason       String?
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata            Json?
  
  // Relations
  refunds             Refund[]
  
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  
  @@unique([provider, providerPaymentId])
  @@index([tenantId, status])
  @@index([provider, providerPaymentId])
  @@map("payments")
}

// ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
model Subscription {
  id                     String      @id @default(cuid())
  tenantId               String      @unique
  tenant                 Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  // ãƒ—ãƒ©ãƒ³æƒ…å ±
  planType               String      // light, standard, premium_ai
  provider               String      // stripe, square, paypal, payjp
  providerSubscriptionId String      // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å´ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status                 String      // active, past_due, canceled, unpaid, trialing
  currentPeriodStart     DateTime
  currentPeriodEnd       DateTime
  cancelAtPeriodEnd      Boolean     @default(false)
  trialEnd               DateTime?
  cancelledAt            DateTime?
  
  // æ±ºæ¸ˆæƒ…å ±
  paymentMethodId        String
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  payments               Payment[]
  invoices               Invoice[]
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata               Json?
  
  createdAt              DateTime    @default(now())
  updatedAt              DateTime    @updatedAt
  
  @@unique([provider, providerSubscriptionId])
  @@index([status, currentPeriodEnd])
  @@index([provider, providerSubscriptionId])
  @@map("subscriptions")
}

// è«‹æ±‚æ›¸
model Invoice {
  id                  String       @id @default(cuid())
  tenantId            String
  tenant              Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  subscriptionId      String
  subscription        Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  
  // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±
  provider            String
  providerInvoiceId   String
  
  // è«‹æ±‚è©³ç´°
  amount              Float
  currency            String       @default("JPY")
  status              String       // draft, open, paid, void, uncollectible, failed
  attemptCount        Int          @default(0)
  
  // æœŸé–“
  periodStart         DateTime
  periodEnd           DateTime
  dueDate             DateTime?
  paidAt              DateTime?
  
  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  invoiceUrl          String?
  invoicePdf          String?
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata            Json?
  
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  
  @@unique([provider, providerInvoiceId])
  @@index([tenantId, status])
  @@index([subscriptionId, status])
  @@index([provider, providerInvoiceId])
  @@map("invoices")
}

// è¿”é‡‘
model Refund {
  id                  String       @id @default(cuid())
  paymentId           String
  payment             Payment      @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  tenantId            String
  
  // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æƒ…å ±
  providerRefundId    String
  
  // è¿”é‡‘è©³ç´°
  amount              Float
  reason              String?
  status              String       // pending, succeeded, failed, canceled
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata            Json?
  
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  
  @@index([paymentId])
  @@index([tenantId])
  @@map("refunds")
}

// Webhook ã‚¤ãƒ™ãƒ³ãƒˆ
model WebhookEvent {
  id          String   @id @default(cuid())
  provider    String   // stripe, square, paypal, payjp
  eventType   String
  eventId     String   // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å´ã®ã‚¤ãƒ™ãƒ³ãƒˆID
  data        Json
  processed   Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([provider, processed])
  @@index([eventType, processed])
  @@unique([provider, eventId])
  @@map("webhook_events")
}

// ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
model Feedback {
  id          String   @id @default(cuid())
  type        String   // bug, feature, general
  title       String
  description String
  severity    String?  // low, medium, high, critical (for bugs)
  category    String?
  screenshot  String?
  rating      Int?     // 1-5 (for general feedback)
  status      String   @default("open") // open, in-progress, resolved, closed
  
  // User info
  userId      String?
  userEmail   String?
  userName    String?
  tenantId    String?
  
  // Technical info
  userAgent   String?
  url         String?
  metadata    String?  // JSON
  
  // Admin fields
  adminNotes  String?
  resolvedAt  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  tenant      Tenant? @relation(fields: [tenantId], references: [id])
  
  @@index([type, status])
  @@index([tenantId, createdAt])
  @@map("feedback")
}

// ã‚¯ã‚¤ãƒƒã‚¯è©•ä¾¡
model QuickRating {
  id          String   @id @default(cuid())
  rating      Int      // 1-5
  userId      String?
  userEmail   String?
  tenantId    String?
  
  createdAt   DateTime @default(now())
  
  // Relations
  tenant      Tenant? @relation(fields: [tenantId], references: [id])
  
  @@index([tenantId, createdAt])
  @@map("quick_ratings")
}

// ãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆç”³ã—è¾¼ã¿
model BetaApplication {
  id              String   @id @default(cuid())
  name            String
  email           String   @unique
  phone           String
  salonName       String
  salonType       String   // hair, beauty, nail, eyelash, barber, other
  numberOfStylists String  // 1, 2-5, 6-10, 11-20, 21+
  currentSoftware String?
  painPoints      String
  expectations    String
  availableHours  String   // 1-2, 3-5, 6-10, 11+
  referralSource  String?  // web-search, sns, referral, advertisement, other
  
  // Application status
  status          String   @default("pending") // pending, approved, rejected, in_review
  reviewNotes     String?
  reviewedAt      DateTime?
  
  // Metadata
  metadata        String?  // JSON
  submittedAt     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([status, submittedAt])
  @@index([salonType, submittedAt])
  @@map("beta_applications")
}

// ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ï¼ˆæ©Ÿèƒ½ãƒˆã‚°ãƒ«ï¼‰
model FeatureFlag {
  id          String   @id @default(cuid())
  key         String   @unique // æ©Ÿèƒ½ã‚­ãƒ¼ (e.g., "setup_wizard", "dashboard_customize", "mobile_view")
  name        String   // è¡¨ç¤ºå
  description String?  // æ©Ÿèƒ½ã®èª¬æ˜
  category    String   // ã‚«ãƒ†ã‚´ãƒª (core, enhancement, experimental, beta)
  
  // æ©Ÿèƒ½ã®çŠ¶æ…‹
  isEnabled   Boolean  @default(false) // ã‚°ãƒ­ãƒ¼ãƒãƒ«æœ‰åŠ¹/ç„¡åŠ¹
  rolloutPercentage Int @default(0)   // ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆç‡ (0-100)
  
  // å¯¾è±¡è¨­å®š
  enabledTenants  String? // ç‰¹å®šã®ãƒ†ãƒŠãƒ³ãƒˆIDã§æœ‰åŠ¹åŒ– (JSONé…åˆ—æ–‡å­—åˆ—)
  enabledPlans    String? // ç‰¹å®šã®ãƒ—ãƒ©ãƒ³ã§æœ‰åŠ¹åŒ– (JSONé…åˆ—æ–‡å­—åˆ—)
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  config      String?  // JSONè¨­å®šãƒ‡ãƒ¼ã‚¿
  dependencies String? // ä¾å­˜ã™ã‚‹ä»–ã®æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã‚­ãƒ¼ (JSONé…åˆ—æ–‡å­—åˆ—)
  
  // ãƒªãƒªãƒ¼ã‚¹æƒ…å ±
  releaseDate DateTime? // ãƒªãƒªãƒ¼ã‚¹äºˆå®šæ—¥
  deprecationDate DateTime? // å»ƒæ­¢äºˆå®šæ—¥
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  tenantFlags TenantFeatureFlag[]
  
  @@index([isEnabled, category])
  @@index([key])
  @@map("feature_flags")
}

// ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°è¨­å®š
model TenantFeatureFlag {
  id          String   @id @default(cuid())
  tenantId    String
  featureFlagId String
  
  // ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã®ä¸Šæ›¸ãè¨­å®š
  isEnabled   Boolean  @default(true)
  config      String?  // ãƒ†ãƒŠãƒ³ãƒˆå›ºæœ‰ã®è¨­å®š (JSON)
  enabledAt   DateTime @default(now())
  
  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  featureFlag FeatureFlag @relation(fields: [featureFlagId], references: [id], onDelete: Cascade)
  
  @@unique([tenantId, featureFlagId])
  @@index([tenantId, isEnabled])
  @@map("tenant_feature_flags")
}

// å¿œæ´ã‚¹ã‚¿ãƒƒãƒ•ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
model SupportStaffProfile {
  id              String   @id @default(cuid())
  name            String
  email           String   @unique
  phone           String
  profilePhoto    String?
  
  // ã‚¹ã‚­ãƒ«ãƒ»è³‡æ ¼
  skills          String   // JSONé…åˆ—: ["cut", "color", "perm", "nail", "eyelash"]
  licenses        String?  // JSONé…åˆ—: ä¿æœ‰è³‡æ ¼
  experience      Int      // çµŒé¨“å¹´æ•°
  specialties     String?  // å¾—æ„åˆ†é‡
  
  // å¸Œæœ›æ¡ä»¶
  preferredAreas  String   // JSONé…åˆ—: å¸Œæœ›å‹¤å‹™åœ°åŸŸ
  maxDistance     Int      @default(20) // kmå˜ä½
  minHourlyRate   Float    // æœ€ä½å¸Œæœ›æ™‚çµ¦
  
  // è©•ä¾¡ãƒ»å®Ÿç¸¾
  rating          Float    @default(0) // 0-5
  completedCount  Int      @default(0) // å®Œäº†ä»¶æ•°
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  isActive        Boolean  @default(true)
  isVerified      Boolean  @default(false) // æœ¬äººç¢ºèªæ¸ˆã¿
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  availabilities  SupportStaffAvailability[]
  applications    SupportStaffApplication[]
  matches         SupportStaffMatch[]
  
  @@index([isActive, isVerified])
  @@map("support_staff_profiles")
}

// å¿œæ´ã‚¹ã‚¿ãƒƒãƒ•å‹¤å‹™å¯èƒ½æœŸé–“
model SupportStaffAvailability {
  id              String   @id @default(cuid())
  staffProfileId  String
  
  // å‹¤å‹™å¯èƒ½æœŸé–“
  availableFrom   DateTime
  availableTo     DateTime
  
  // å‹¤å‹™æ¡ä»¶
  availableDays   String   // JSONé…åˆ—: ["monday", "tuesday", ...]
  availableHours  String   // JSONé…åˆ—: ["09:00-12:00", "13:00-18:00"]
  hourlyRate      Float    // å¸Œæœ›æ™‚çµ¦
  
  // å¯¾å¿œå¯èƒ½ã‚µãƒ¼ãƒ“ã‚¹
  services        String   // JSONé…åˆ—: ã“ã®æœŸé–“ã§å¯¾å¿œå¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹
  
  // ã‚¨ãƒªã‚¢è¨­å®š
  preferredAreas  String?  // JSONé…åˆ—: ã“ã®æœŸé–“ã®å¸Œæœ›ã‚¨ãƒªã‚¢ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¨ç•°ãªã‚‹å ´åˆï¼‰
  
  notes           String?  // å‚™è€ƒ
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  staffProfile    SupportStaffProfile @relation(fields: [staffProfileId], references: [id], onDelete: Cascade)
  applications    SupportStaffApplication[]
  
  @@index([staffProfileId, isActive])
  @@index([availableFrom, availableTo])
  @@map("support_staff_availabilities")
}

// åº—èˆ—ã‹ã‚‰ã®å¿œæ´ä¾é ¼
model SupportStaffRequest {
  id              String   @id @default(cuid())
  tenantId        String
  requesterId     String   // ä¾é ¼ã—ãŸã‚¹ã‚¿ãƒƒãƒ•ã®ID
  
  // ä¾é ¼å†…å®¹
  title           String
  description     String
  requiredSkills  String   // JSONé…åˆ—: å¿…è¦ã‚¹ã‚­ãƒ«
  
  // å‹¤å‹™è©³ç´°
  workDate        DateTime
  startTime       String   // "09:00"
  endTime         String   // "18:00"
  breakTime       Int      @default(60) // ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰
  
  // å ±é…¬
  hourlyRate      Float
  transportationFee Float? // äº¤é€šè²»
  
  // å ´æ‰€
  location        String   // åº—èˆ—ä½æ‰€
  latitude        Float
  longitude       Float
  nearestStation  String?  // æœ€å¯„ã‚Šé§…
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  urgencyLevel    String   @default("NORMAL") // LOW, NORMAL, HIGH, URGENT
  status          String   @default("OPEN") // OPEN, MATCHED, CONFIRMED, COMPLETED, CANCELLED
  
  // è¡¨ç¤ºè¨­å®š
  isPublic        Boolean  @default(true) // ä¸€èˆ¬å…¬é–‹
  maxApplications Int      @default(10) // æœ€å¤§å¿œå‹Ÿæ•°
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tenant          Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  requester       Staff         @relation("SupportStaffRequester", fields: [requesterId], references: [id], onDelete: Cascade)
  applications    SupportStaffApplication[]
  match           SupportStaffMatch?
  
  @@index([tenantId, status])
  @@index([status, workDate])
  @@index([latitude, longitude])
  @@map("support_staff_requests")
}

// AIãƒãƒ£ãƒƒãƒˆå±¥æ­´
model AIChatHistory {
  id          String   @id @default(cuid())
  sessionId   String
  userId      String
  userMessage String
  aiResponse  String
  metadata    String?  // JSON: model, tokensUsed, etc
  createdAt   DateTime @default(now())
  
  @@index([sessionId])
  @@index([userId])
  @@map("ai_chat_history")
}

// AIãƒãƒ£ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
model AIChatFeedback {
  id        String   @id @default(cuid())
  sessionId String
  messageId String
  userId    String
  helpful   Boolean
  comment   String?
  createdAt DateTime @default(now())
  
  @@index([sessionId])
  @@map("ai_chat_feedback")
}

// å¿œæ´ã‚¹ã‚¿ãƒƒãƒ•ã‹ã‚‰ã®å¿œå‹Ÿ
model SupportStaffApplication {
  id              String   @id @default(cuid())
  requestId       String
  staffProfileId  String
  availabilityId  String?
  
  // å¿œå‹Ÿå†…å®¹
  message         String?  // å¿œå‹Ÿãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  proposedRate    Float?   // ææ¡ˆæ™‚çµ¦ï¼ˆç•°ãªã‚‹å ´åˆï¼‰
  canArrive       Boolean  @default(true) // åˆ°ç€å¯èƒ½ã‹
  estimatedArrival String? // åˆ°ç€äºˆå®šæ™‚åˆ»
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status          String   @default("PENDING") // PENDING, VIEWED, SHORTLISTED, ACCEPTED, REJECTED
  viewedAt        DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  request         SupportStaffRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  staffProfile    SupportStaffProfile @relation(fields: [staffProfileId], references: [id], onDelete: Cascade)
  availability    SupportStaffAvailability? @relation(fields: [availabilityId], references: [id], onDelete: SetNull)
  match           SupportStaffMatch?
  
  @@unique([requestId, staffProfileId])
  @@index([requestId, status])
  @@index([staffProfileId])
  @@map("support_staff_applications")
}

// ãƒãƒƒãƒãƒ³ã‚°æˆç«‹
model SupportStaffMatch {
  id              String   @id @default(cuid())
  requestId       String   @unique
  applicationId   String   @unique
  supportStaffId  String
  
  // ç¢ºå®šæ¡ä»¶
  agreedRate      Float
  agreedStartTime String
  agreedEndTime   String
  transportationFee Float?
  
  // å®Ÿç¸¾
  actualStartTime DateTime?
  actualEndTime   DateTime?
  actualBreakTime Int?     // å®Ÿéš›ã®ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰
  
  // è©•ä¾¡
  staffRating     Int?     // 1-5 åº—èˆ—â†’ã‚¹ã‚¿ãƒƒãƒ•è©•ä¾¡
  tenantRating    Int?     // 1-5 ã‚¹ã‚¿ãƒƒãƒ•â†’åº—èˆ—è©•ä¾¡
  staffFeedback   String?
  tenantFeedback  String?
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status          String   @default("CONFIRMED") // CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED, DISPUTED
  completedAt     DateTime?
  cancelledAt     DateTime?
  cancelReason    String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  request         SupportStaffRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  application     SupportStaffApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  supportStaff    SupportStaffProfile @relation(fields: [supportStaffId], references: [id], onDelete: Cascade)
  
  @@index([status])
  @@index([supportStaffId, status])
  @@map("support_staff_matches")
}

// å¿œæ´ã‚¹ã‚¿ãƒƒãƒ•é€šçŸ¥è¨­å®š
model SupportStaffNotification {
  id              String   @id @default(cuid())
  staffProfileId  String?
  tenantId        String?
  
  // é€šçŸ¥ã‚¿ã‚¤ãƒ—
  type            String   // NEW_REQUEST, APPLICATION_STATUS, MATCH_CONFIRMED, REMINDER
  
  // é€šçŸ¥å†…å®¹
  title           String
  message         String
  actionUrl       String?
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  isRead          Boolean  @default(false)
  readAt          DateTime?
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata        String?  // JSON: è¿½åŠ æƒ…å ±
  
  createdAt       DateTime @default(now())
  
  @@index([staffProfileId, isRead])
  @@index([tenantId, isRead])
  @@map("support_staff_notifications")
}

// çµ¦æ–™è¦‹ãˆã‚‹åŒ– - æœˆåˆ¥çµ¦ä¸ã‚µãƒãƒªãƒ¼
model SalaryDashboard {
  id              String   @id @default(cuid())
  staffId         String
  tenantId        String
  year            Int
  month           Int
  
  // åŸºæœ¬çµ¦ä¸æƒ…å ±
  baseSalary      Float    @default(0)
  commission      Float    @default(0) // æ­©åˆçµ¦
  bonus           Float    @default(0)
  supportEarnings Float    @default(0) // å¿œæ´ç¾å®¹å¸«ã§ã®åå…¥
  deductions      Float    @default(0) // æ§é™¤é¡
  totalGross      Float    @default(0) // ç·æ”¯çµ¦é¡
  totalNet        Float    @default(0) // æ‰‹å–ã‚Šé¡
  
  // åŠ´åƒæ™‚é–“
  regularHours    Float    @default(0)
  overtimeHours   Float    @default(0)
  supportHours    Float    @default(0)
  totalHours      Float    @default(0)
  
  // å®Ÿç¸¾æŒ‡æ¨™
  totalCustomers  Int      @default(0)
  totalRevenue    Float    @default(0)
  avgServiceTime  Float    @default(0)
  customerRating  Float    @default(0)
  
  // ç›®æ¨™ã¨é€²æ—
  monthlyGoal     Float?
  goalProgress    Float    @default(0) // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸
  projectedTotal  Float    @default(0) // æœˆæœ«äºˆæƒ³é¡
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  staff           Staff    @relation("SalaryDashboard", fields: [staffId], references: [id], onDelete: Cascade)
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  dailyRecords    DailySalaryRecord[]
  
  @@unique([staffId, year, month])
  @@index([tenantId, year, month])
  @@map("salary_dashboard")
}

// æ—¥åˆ¥çµ¦ä¸è¨˜éŒ²
model DailySalaryRecord {
  id              String   @id @default(cuid())
  dashboardId     String
  staffId         String
  date            DateTime
  
  // æ—¥åˆ¥å®Ÿç¸¾
  hoursWorked     Float    @default(0)
  customersServed Int      @default(0)
  dailyRevenue    Float    @default(0)
  dailyEarnings   Float    @default(0)
  supportHours    Float    @default(0) // å¿œæ´ç¾å®¹å¸«æ™‚é–“
  supportEarnings Float    @default(0) // å¿œæ´ç¾å®¹å¸«åå…¥
  
  // è©•ä¾¡
  customerRating  Float?
  notes           String?
  
  createdAt       DateTime @default(now())
  
  // Relations
  dashboard       SalaryDashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  staff           Staff           @relation("DailySalaryRecord", fields: [staffId], references: [id], onDelete: Cascade)
  
  @@unique([staffId, date])
  @@index([dashboardId, date])
  @@map("daily_salary_records")
}

// ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ãƒ«è¨­å®š
model IncentiveRule {
  id              String   @id @default(cuid())
  tenantId        String
  name            String
  description     String?
  type            String   // PERFORMANCE, SKILL, SUPPORT, REFERRAL, LOYALTY
  
  // æ¡ä»¶è¨­å®š
  conditions      String   // JSON: é”æˆæ¡ä»¶
  rewardType      String   // BONUS, COMMISSION_RATE, FIXED_AMOUNT
  rewardValue     Float    // å ±é…¬é¡ã¾ãŸã¯ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸
  
  // æœŸé–“è¨­å®š
  isActive        Boolean  @default(true)
  validFrom       DateTime?
  validTo         DateTime?
  
  // å¯¾è±¡è¨­å®š
  targetStaffIds  String?  // JSONé…åˆ—: å¯¾è±¡ã‚¹ã‚¿ãƒƒãƒ•ID
  targetRoles     String?  // JSONé…åˆ—: å¯¾è±¡ãƒ­ãƒ¼ãƒ«
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  achievements    StaffAchievement[]
  
  @@index([tenantId, isActive])
  @@index([type, isActive])
  @@map("incentive_rules")
}

// ã‚¹ã‚¿ãƒƒãƒ•é”æˆè¨˜éŒ²
model StaffAchievement {
  id              String   @id @default(cuid())
  staffId         String
  ruleId          String
  tenantId        String
  
  // é”æˆè©³ç´°
  achievedAt      DateTime
  achievedValue   Float    // é”æˆã—ãŸå€¤
  rewardAmount    Float    // ç²å¾—å ±é…¬é¡
  status          String   @default("EARNED") // EARNED, PAID, CANCELLED
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata        String?  // JSON: é”æˆè©³ç´°ãƒ‡ãƒ¼ã‚¿
  notes           String?
  
  createdAt       DateTime @default(now())
  
  // Relations
  staff           Staff    @relation("StaffAchievement", fields: [staffId], references: [id], onDelete: Cascade)
  rule            IncentiveRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([staffId, achievedAt])
  @@index([tenantId, achievedAt])
  @@map("staff_achievements")
}

// ãƒ—ãƒ¬ãƒŸã‚¢ãƒ çµŒå–¶æˆ¦ç•¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
model BusinessMetrics {
  id              String   @id @default(cuid())
  tenantId        String
  metricDate      DateTime
  
  // å£²ä¸ŠæŒ‡æ¨™
  dailyRevenue    Float    @default(0)
  monthlyRevenue  Float    @default(0)
  yearlyRevenue   Float    @default(0)
  targetRevenue   Float?   // ç›®æ¨™å£²ä¸Š
  
  // é¡§å®¢æŒ‡æ¨™
  newCustomers    Int      @default(0)
  repeatCustomers Int      @default(0)
  lostCustomers   Int      @default(0)
  avgCustomerValue Float   @default(0)
  customerRetentionRate Float @default(0)
  
  // åŠ¹ç‡æŒ‡æ¨™
  avgServiceTime  Float    @default(0) // å¹³å‡æ–½è¡“æ™‚é–“
  chairUtilization Float   @default(0) // å¸­ç¨¼åƒç‡
  staffProductivity Float  @default(0) // ã‚¹ã‚¿ãƒƒãƒ•ç”Ÿç”£æ€§
  
  // åœ¨åº«ãƒ»ã‚³ã‚¹ãƒˆ
  inventoryCost   Float    @default(0)
  laborCost       Float    @default(0)
  overheadCost    Float    @default(0)
  profitMargin    Float    @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@unique([tenantId, metricDate])
  @@index([tenantId, metricDate])
  @@map("business_metrics")
}

// ç«¶åˆåˆ†æãƒ‡ãƒ¼ã‚¿
model CompetitorAnalysis {
  id              String   @id @default(cuid())
  tenantId        String
  competitorName  String
  
  // ä½ç½®æƒ…å ±
  distance        Float    // km
  location        String
  
  // ä¾¡æ ¼æ¯”è¼ƒ
  avgMenuPrice    Float
  pricePosition   String   // LOWER, SIMILAR, HIGHER
  
  // ã‚µãƒ¼ãƒ“ã‚¹åˆ†æ
  services        String   // JSON: æä¾›ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¹ãƒˆ
  uniqueServices  String?  // JSON: ç‹¬è‡ªã‚µãƒ¼ãƒ“ã‚¹
  
  // è©•ä¾¡
  onlineRating    Float?
  reviewCount     Int?
  
  // åˆ†æãƒ‡ãƒ¼ã‚¿
  strengthPoints  String?  // JSON: å¼·ã¿
  weaknessPoints  String?  // JSON: å¼±ã¿
  threats         String?  // JSON: è„…å¨
  opportunities   String?  // JSON: æ©Ÿä¼š
  
  lastAnalyzedAt  DateTime
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
  @@map("competitor_analysis")
}

// çµŒå–¶æˆ¦ç•¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
model StrategicAction {
  id              String   @id @default(cuid())
  tenantId        String
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°
  title           String
  description     String
  category        String   // REVENUE, COST, CUSTOMER, OPERATION, MARKETING
  priority        String   // CRITICAL, HIGH, MEDIUM, LOW
  
  // ç›®æ¨™ã¨æŒ‡æ¨™
  targetMetric    String   // å½±éŸ¿ã™ã‚‹æŒ‡æ¨™
  targetValue     Float    // ç›®æ¨™å€¤
  currentValue    Float?   // ç¾åœ¨å€¤
  expectedImpact  Float    // æœŸå¾…ã•ã‚Œã‚‹å½±éŸ¿ï¼ˆ%ï¼‰
  
  // å®Ÿè¡Œè¨ˆç”»
  assignedTo      String?  // ã‚¹ã‚¿ãƒƒãƒ•IDã¾ãŸã¯ãƒ­ãƒ¼ãƒ«
  startDate       DateTime
  dueDate         DateTime
  status          String   @default("PLANNED") // PLANNED, IN_PROGRESS, COMPLETED, CANCELLED
  
  // çµæœæ¸¬å®š
  actualImpact    Float?   // å®Ÿéš›ã®å½±éŸ¿ï¼ˆ%ï¼‰
  completedAt     DateTime?
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  insights        InsightActionLink[]
  
  @@index([tenantId, status])
  @@index([tenantId, priority])
  @@map("strategic_actions")
}

// AIçµŒå–¶ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
model BusinessInsight {
  id              String   @id @default(cuid())
  tenantId        String
  
  // ã‚¤ãƒ³ã‚µã‚¤ãƒˆè©³ç´°
  type            String   // TREND, ANOMALY, PREDICTION, RECOMMENDATION
  category        String   // REVENUE, CUSTOMER, OPERATION, RISK
  title           String
  description     String
  
  // é‡è¦åº¦ã¨ç¢ºä¿¡åº¦
  importance      String   // CRITICAL, HIGH, MEDIUM, LOW
  confidence      Float    // 0.0-1.0
  
  // åˆ†æãƒ‡ãƒ¼ã‚¿
  analysisData    String   // JSON: è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿
  evidence        String?  // JSON: æ ¹æ‹ ãƒ‡ãƒ¼ã‚¿
  
  // äºˆæ¸¬æƒ…å ±ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰
  predictedValue  Float?
  predictedDate   DateTime?
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆ
  suggestedActions String? // JSON: ææ¡ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  
  // æœ‰åŠ¹æœŸé™
  validUntil      DateTime
  dismissed       Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  linkedActions   InsightActionLink[]
  
  @@index([tenantId, type, dismissed])
  @@index([tenantId, importance])
  @@map("business_insights")
}

// ã‚¤ãƒ³ã‚µã‚¤ãƒˆã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢é€£
model InsightActionLink {
  insightId       String
  actionId        String
  
  insight         BusinessInsight @relation(fields: [insightId], references: [id], onDelete: Cascade)
  action          StrategicAction @relation(fields: [actionId], references: [id], onDelete: Cascade)
  
  @@id([insightId, actionId])
  @@map("insight_action_links")
}

// çµŒå–¶ç›®æ¨™è¨­å®š
model BusinessGoal {
  id              String   @id @default(cuid())
  tenantId        String
  
  // ç›®æ¨™è©³ç´°
  name            String
  description     String?
  metric          String   // revenue, customer_count, retention_rate, etc.
  targetValue     Float
  currentValue    Float    @default(0)
  
  // æœŸé–“
  period          String   // MONTHLY, QUARTERLY, YEARLY
  startDate       DateTime
  endDate         DateTime
  
  // é€²æ—
  progress        Float    @default(0) // 0-100%
  status          String   @default("ACTIVE") // ACTIVE, ACHIEVED, FAILED, CANCELLED
  
  // æˆ¦ç•¥
  strategies      String?  // JSON: é”æˆæˆ¦ç•¥
  milestones      String?  // JSON: ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
  
  achievedAt      DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([tenantId, period, status])
  @@map("business_goals")
}

// çµŒå–¶ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´
model ManagementReport {
  id              String   @id @default(cuid())
  tenantId        String
  
  // ãƒ¬ãƒãƒ¼ãƒˆæƒ…å ±
  reportType      String   // DAILY, WEEKLY, MONTHLY, QUARTERLY, YEARLY
  reportDate      DateTime
  title           String
  
  // ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹
  summary         String   // ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼
  metrics         String   // JSON: ä¸»è¦æŒ‡æ¨™
  insights        String   // JSON: ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
  recommendations String   // JSON: ææ¡ˆäº‹é …
  
  // AIåˆ†æçµæœ
  aiAnalysis      String?  // JSON: AIè©³ç´°åˆ†æ
  riskAssessment  String?  // JSON: ãƒªã‚¹ã‚¯è©•ä¾¡
  opportunities   String?  // JSON: æˆé•·æ©Ÿä¼š
  
  // é…ä¿¡æƒ…å ±
  recipients      String?  // JSON: é…ä¿¡å…ˆãƒªã‚¹ãƒˆ
  sentAt          DateTime?
  
  createdAt       DateTime @default(now())
  
  // Relations
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([tenantId, reportType, reportDate])
  @@map("management_reports")
}


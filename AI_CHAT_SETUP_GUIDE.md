# 🤖 AIチャットサポート機能 セットアップガイド

## 概要

美容室管理システムに統合されたAIチャットサポート機能は、ユーザーがシステムの使い方や機能について質問できる対話型のサポートシステムです。OpenAI GPT-3.5 Turboを使用し、24時間365日サポートを提供します。

## 主な機能

### 1. インテリジェントな対話
- システムの使い方に関する質問に自然な日本語で回答
- 会話の文脈を理解し、前の質問を踏まえた回答を生成
- 美容室業務に特化した専門的な知識を活用

### 2. 豊富なナレッジベース
- 予約管理、顧客管理、スタッフ管理などの主要機能をカバー
- よくある質問（FAQ）への即座の回答
- 具体的な操作手順を番号付きリストで提供

### 3. ユーザーフレンドリーなUI
- 画面右下に常駐するチャットウィジェット
- ミニマイズ機能で邪魔にならない設計
- 提案ボタンで関連質問を簡単に選択
- フィードバック機能で回答品質を継続的に改善

## セットアップ手順

### 1. OpenAI APIキーの取得

1. [OpenAI Platform](https://platform.openai.com/)にアクセス
2. アカウントを作成またはログイン
3. API Keysページで新しいAPIキーを生成
4. キーを安全に保管

### 2. 環境変数の設定

```bash
# backend/.envファイルに以下を追加
OPENAI_API_KEY=sk-your-actual-api-key-here
OPENAI_MODEL=gpt-3.5-turbo  # オプション（デフォルト: gpt-3.5-turbo）
OPENAI_MAX_TOKENS=500       # オプション（デフォルト: 500）
```

### 3. データベースマイグレーション

```bash
cd backend
npx prisma migrate dev --name add_ai_chat_tables
```

### 4. サーバー再起動

```bash
# バックエンドサーバーを再起動
npm run dev
```

## 使い方

### ユーザー向け

1. **チャットを開く**
   - 画面右下の青いメッセージアイコンをクリック

2. **質問する**
   - テキストボックスに質問を入力
   - Enterキーまたは送信ボタンをクリック

3. **提案を使う**
   - AIからの回答に含まれる提案ボタンをクリックして関連質問

4. **フィードバック**
   - 回答が役立った場合は👍、そうでない場合は👎をクリック

### よくある質問例

- 「予約を登録するには？」
- 「顧客の来店履歴を確認したい」
- 「スタッフのシフトを変更する方法は？」
- 「売上レポートをエクスポートしたい」
- 「LINE連携の設定方法を教えて」

## コスト管理

### GPT-3.5 Turboの料金（2024年時点）
- 入力: $0.0005 / 1K トークン
- 出力: $0.0015 / 1K トークン

### コスト削減のヒント

1. **キャッシング**
   - よくある質問はナレッジベースから直接回答
   - 同じ質問への重複APIコールを避ける

2. **トークン制限**
   - 環境変数でmax_tokensを適切に設定（推奨: 500）
   - 長すぎる会話履歴は自動的にトリミング

3. **レート制限**
   - ユーザーごとの質問数を制限（必要に応じて）
   - 1日あたりの総APIコール数を監視

### 月間コスト試算例
- 1日100質問 × 30日 = 3,000質問/月
- 平均500トークン/質問 = 1,500,000トークン/月
- 推定コスト: 約$2.25/月

## トラブルシューティング

### エラー: "AIサポートへの接続に問題が発生しました"
1. OpenAI APIキーが正しく設定されているか確認
2. インターネット接続を確認
3. OpenAIのAPIステータスを確認

### チャットウィジェットが表示されない
1. ブラウザのコンソールでエラーを確認
2. JavaScriptが有効になっているか確認
3. ブラウザキャッシュをクリア

### 回答が遅い・タイムアウトする
1. ネットワーク速度を確認
2. OpenAIのAPIレスポンスタイムを確認
3. max_tokensの値を減らしてみる

## カスタマイズ

### ナレッジベースの拡張

`backend/src/services/aiSupportService.ts`の`KNOWLEDGE_BASE`配列に質問と回答を追加：

```typescript
{
  category: 'カスタム機能',
  questions: [
    {
      q: '独自の機能について',
      a: '具体的な操作手順...',
    },
  ],
}
```

### システムプロンプトの調整

同ファイルの`SYSTEM_PROMPT`を編集して、AIの振る舞いをカスタマイズ：

```typescript
const SYSTEM_PROMPT = `あなたは[店舗名]の専門サポートアシスタントです...`
```

## セキュリティ考慮事項

1. **APIキーの保護**
   - 環境変数に保存し、コードに直接記載しない
   - .envファイルを.gitignoreに追加

2. **入力サニタイゼーション**
   - ユーザー入力は自動的にサニタイズ
   - SQLインジェクションやXSS攻撃を防御

3. **レート制限**
   - 過度な使用を防ぐための制限を実装済み
   - 必要に応じて調整可能

## 今後の拡張予定

- [ ] 音声入力対応
- [ ] 多言語サポート
- [ ] より高度なコンテキスト理解
- [ ] カスタムトレーニングデータの追加
- [ ] 分析ダッシュボードとの統合

---

お問い合わせ: support@salon-system.com